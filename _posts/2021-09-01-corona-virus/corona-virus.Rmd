---
title: "Blog1"
description: |
  A new article created using the Distill format.
author:
  - name: Mohammed Faizan
    url: https://etc5523-2021.github.io/blog-mohammedfaizan0014
    affiliation: Monash University
    affiliation_url: https://example.com/spacelysprokets
date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse) 
library(plotly)
library(naniar)
library(visdat)
library(bookdown)
library(knitr)
library(ggplot2)
library(lubridate)
library(geosphere)
library(ggmap)
library(ggthemes)
library(maps)
library(patchwork)
library(here)
library(readxl)
library(readr)
library(kableExtra)
library(rpart)
library(broomstick)
library(tidytext)
library(dygraphs)
library(quantmod)
library(igraph)
library(ggraph)
library(ggrepel)
library(tidyverse)
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(naniar)
library(visdat)
library(citation)
library(knitr)
library(scales)
library(glue)
library(unglue)
library(plotly)
library(ggplot2)
library(ggraph)
library(ggbeeswarm)
library(plotly)
library(gt)
library(ggthemes)
library(leaflet)
library(here)
library(DT)
library(RColorBrewer)
library(lubridate)
```

```{r load-data}
coviddata <- readr::read_csv('https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv')
iran <- coviddata  %>% 
  filter(location=="Iran") %>% 
  mutate(year=year(date),
         month=month(date),
         day=day(date)) 

#each observation is a day
```

```{r}
missing_variables <- miss_var_summary(iran) %>% filter(pct_miss==100) %>% pull(variable)

iran1 <- iran %>% select(-c(all_of(missing_variables))) 

iran_info <- iran1 %>% select(37:51)  %>%
 pivot_longer(cols = -year,
               names_to = "variable",
               values_to = "value") %>% 
  distinct() %>% 
  pivot_wider(names_from = year,
              values_from = value)

info_variables <- iran_info %>% pull(variable)
iran2 <- iran1 %>% 
  select(-c(all_of(info_variables))) %>% 
  select(-c(contains("smoothed")))

iran3 <- iran2 %>%
 pivot_longer(
   ends_with(c("_cases","_deaths","_tests","_vaccinations")),
               names_to = c("total_new", ".value"),
               names_pattern = 
     "(total|new)_(cases|deaths|tests|vaccinations)") %>%
 pivot_longer(
   ends_with(c("_per_million")),
               names_to = c("total_new_per", ".value"),
               names_pattern = 
     "(total|new)_(cases_per_million|deaths_per_million)") %>%
  filter(total_new == total_new_per) %>% 
   pivot_longer(
   ends_with(c("_per_thousand")),
               names_to = c("total_new_per_thousand", ".value"),
               names_pattern = 
     "(total|new)_(tests_per_thousand)") %>%
    filter(total_new == total_new_per_thousand) 

iran4 <- iran3 %>% 
  rename(	
    "people_first_vaccinated"=people_vaccinated,
    "people_first_vaccinated_per_hundred"=people_vaccinated_per_hundred,
    "per_hundred_total_vaccinations"=total_vaccinations_per_hundred) %>%
 pivot_longer(
   ends_with(c("_vaccinated")),
               names_to = c("first_fully", ".value"),
               names_pattern = 
     "people_(first|fully)_(vaccinated)") %>% 
 pivot_longer(
   ends_with(c("_per_hundred")),
               names_to = c("first_fully_per", ".value"),
               names_pattern = 
     "people_(first|fully)_(vaccinated_per_hundred)") %>% 
  filter(first_fully == first_fully_per) %>% 
  select(-c(total_new_per,total_new_per_thousand,first_fully_per,tests_units)) %>% 
  rename("total_vaccinations_per_hundred"=per_hundred_total_vaccinations)

miss_summary <- miss_var_summary(iran4)
```



# Data description

### Overview of the Covid data {#overviewbarstool}

The UN data on death has **`r ncol(iran)`** variables and **`r nrow(iran)`** records. 
The variables in the data are: **`r names(iran)`**

checking missingness:**`r any_miss(iran)`**

**There is no missingness in the data.**

###Unique Values of each varibale in the data set are displayed below:

- **Year**: `r unique(iran$year)`

- **Summary of Cases**: 
    - Minimum Cases: `r min(iran$new_cases)`
    - Median Cases:  `r median(iran$new_cases)`
    - Maximum Cases: `r max(iran$new_cases)`
    
###Cases Distribution
```{r cases-distribution, message=FALSE,warning=FALSE}


iran %>% 
  #group_by(Cause) %>% 
  ggplot() +
  geom_histogram(mapping = aes(x = new_cases)) +
  labs(title = "Case Distribution in Covid Data", x = "Cases", y = "Count")#+coord_cartesian(xlim=c(0,5000))

iran %>% 
  #group_by(Cause) %>% 
  ggplot() +
  geom_histogram(mapping = aes(x = new_deaths)) +
  labs(title = "Death Distribution in Covid Data", x = "Cases", y = "Count")#+coord_cartesian(xlim=c(0,5000))

```

The deaths distribution is skewed and has most records with near to 1500 deaths and has around 200 records with near to 2000, 3000 and 4000 deaths each.

Top ten causes of death are shown in Table \@ref(tab:deaths-cause).

```{r deaths-cause}
temp <- iran%>%group_by(month,year)%>%
  summarise(n_cases=sum(new_cases),
            n_deaths = sum(new_deaths),
            n_vaccinated=sum()) %>% 
  arrange(year,month)

temp %>% view()
death_cause <- knitr::kable(temp, caption = "Deaths by cause over all years, ages, sex")
death_cause

```



```{r}
iran_info <- iran_info %>% 
  mutate(`2020`=round(`2020`,2),
                    `2021`=round(`2021`,2)) 
iran_info

```



# Analysis and findings

```{r new_cases}

iran %>% 
  select(new_cases,new_deaths) %>% 
  xts(order.by=iran$date) %>% 
  dygraph( main = NULL, xlab = NULL, ylab = NULL, periodicity = NULL,
  group = NULL, elementId = NULL, width = NULL, height = NULL)%>% 
  dyLegend(show = "always", hideOnMouseOut = FALSE)%>%
  dyAxis("y", label = "Number") %>%
  dySeries("new_deaths", axis = 'y2') %>% 
   dyAxis("y", label = "Cases") %>%
   dyAxis("y2", label = "Deaths") %>%
  dyOptions(axisLineWidth = 1.5, fillGraph = FALSE, drawGrid = FALSE) %>%
  dyRebase() %>%
  dyRangeSelector(dateWindow = c("2021-08-23","2021-08-30"))

```


```{r total_cases}
 iran %>% 
  select(total_cases,total_deaths) %>% 
  xts(order.by=iran$date)  %>% 
  dygraph( main = NULL, xlab = NULL, ylab = NULL, periodicity = NULL,
  group = NULL, elementId = NULL, width = NULL, height = NULL)%>% 
  dyLegend(show = "always", hideOnMouseOut = FALSE)%>%
  dyAxis("y", label = "Number") %>%
    dySeries("total_deaths", axis = 'y2') %>% 
  dyOptions(axisLineWidth = 1.5, fillGraph = FALSE, drawGrid = FALSE)  %>%
  dyRangeSelector()

```


```{r}
peru %>% 
  group_by(year, month) %>%
  summarise("TotalCases" = round(sum(new_cases)),
            "Cases in a month" = spk_chr(new_cases, type ="line"),
            "New Deaths" = round(sum(new_deaths)),
            "Death %" = spk_chr(new_deaths, type ="line"),)%>%
   arrange(-year, -month) %>% 
  rename(Year = year, Month = month)%>%  
  datatable(escape = FALSE, 
            ,caption = htmltools::tags$caption( style = 'caption-side: top; 
                                                text-align: center;  color:black; font-size:120% ;',
                                                'COVID-19 Deaths'),
            options = c (list(pageLength = 20 ))) %>%
  spk_add_deps()
```

